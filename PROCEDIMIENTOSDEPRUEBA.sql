USE bateriacamiondb;

--------------------------------------------------------
-- Insercion de datos en procedimientos alamcenados --
--------------------------------------------------------

-- EMPRESAS --
DELIMITER //
CREATE PROCEDURE AGREGAR_EMPRESAS
(IN NOM VARCHAR(30), IN EST BOOLEAN)
BEGIN
	INSERT INTO empresas(NOM_EMP, EST_EMP)
    VALUES(NOM, EST);
END //

-- TRABAJADORES --
DELIMITER //
CREATE PROCEDURE AGREGAR_TRABAJADORES
(IN NOM VARCHAR(30), IN APE VARCHAR(30), IN DNI VARCHAR(30), IN EST BOOLEAN , IN EMPRESA INT)
BEGIN
	INSERT INTO trabajadores(NOM_TRA, APE_TRA, DNI_TRA, EST_TRA, EMPRESA_ID)
    VALUES(NOM, APE, DNI,EST, EMPRESA);
END //

-- CAMIONES --
DELIMITER //
CREATE PROCEDURE AGREGAR_CAMIONES
(IN PLACA VARCHAR(30), IN EMPRESA INT, IN TRABAJADOR INT, IN EST BOOLEAN)
BEGIN
	INSERT INTO camiones(PLACA_CAM, EMP_ID, TRA_ID, EST_CAM)
    VALUES(PLACA, EMPRESA, TRABAJADOR, EST);
END //

-- BATERIAS --
DELIMITER //
CREATE PROCEDURE AGREGAR_BATERIAS
(IN NOMBRE VARCHAR(30), IN CAMION INT, IN EST BOOLEAN)
BEGIN
	INSERT INTO baterias(NOM_BAT, CAM_ID, EST_BAT)
    VALUES(NOMBRE, CAMION, EST);
END //

-- DETALLE DE CAMIONES --
DELIMITER //
CREATE PROCEDURE AGREGAR_DETALLE_BATERIAS
(IN BATERIA INT, IN DIAD DATE, IN HORAD TIME, IN VOLTAJED DOUBLE, IN BATERIAD INT, IN TEMPERATURAD DOUBLE, IN EST BOOLEAN)
BEGIN
	INSERT INTO detalle_baterias(BAT_ID, DIA, HORA, VOLTAJE, CARGA, TEMPERATURA, EST_DC)
    VALUES(BATERIA, DIAD, HORAD, VOLTAJED, BATERIAD, TEMPERATURAD, EST);
END //


--------------------------------------------------------
-- Insercion de datos en procedimientos alamcenados --
--------------------------------------------------------

-- EMPRESAS --
CALL AGREGAR_EMPRESAS('SurfaceItn', '1');
CALL AGREGAR_EMPRESAS('IMPORTPERIO', '1');

-- TRABAJADORES --
CALL AGREGAR_TRABAJADORES('JUAN', 'TORRES', '78547689', 1, 1);
CALL AGREGAR_TRABAJADORES('MARCO', 'ANTONIO', '41218722', 1, 1);
CALL AGREGAR_TRABAJADORES('FRANK', 'MILLER', '78547688', 1, 2);

-- CAMIONES --
CALL AGREGAR_CAMIONES('ABC-001', 1, 1, 1);
CALL AGREGAR_CAMIONES('ABC-002', 1, 2, 1);
CALL AGREGAR_CAMIONES('ABC-003', 2, 3, 1);
CALL AGREGAR_CAMIONES('ABC-007', 2, 3, 1);

-- BATERIAS --
CALL AGREGAR_BATERIAS('AZUS2201',1,1);
CALL AGREGAR_BATERIAS('AZUS2202',1,1);
CALL AGREGAR_BATERIAS('AZUS2203',1,1);
CALL AGREGAR_BATERIAS('AZUS2204',1,1);
CALL AGREGAR_BATERIAS('ZUS2201',2,1);
CALL AGREGAR_BATERIAS('ZUS2202',2,1);
CALL AGREGAR_BATERIAS('ZUS2203',2,1);
CALL AGREGAR_BATERIAS('ZUS2204',2,1);

-- DETALLE CAMIONES --
CALL AGREGAR_DETALLE_BATERIAS(1, '2023-05-25', '12:30:00', 12.5, 80, 25.5, 1);
CALL AGREGAR_DETALLE_BATERIAS(1, '2023-05-25', '13:30:00', 12.5, 70, 40.5, 1);
CALL AGREGAR_DETALLE_BATERIAS(1, '2023-05-25', '14:30:00', 12.5, 60, 20.3, 1);
CALL AGREGAR_DETALLE_BATERIAS(2, '2023-05-25', '12:30:00', 12.5, 90, 25.5, 1);
CALL AGREGAR_DETALLE_BATERIAS(2, '2023-05-25', '13:30:00', 10.5, 75, 30.2, 1);
CALL AGREGAR_DETALLE_BATERIAS(2, '2023-05-25', '14:30:00', 12.5, 60, 20.3, 1);
CALL AGREGAR_DETALLE_BATERIAS(3, '2023-05-25', '12:30:00', 10.5, 95, 25.5, 1);
CALL AGREGAR_DETALLE_BATERIAS(3, '2023-05-25', '13:30:00', 11.5, 81, 15.5, 1);
CALL AGREGAR_DETALLE_BATERIAS(3, '2023-05-25', '14:30:00', 10.5, 54, 20.3, 1);
CALL AGREGAR_DETALLE_BATERIAS(4, '2023-05-25', '12:30:00', 12.5, 80, 25.5, 1);
CALL AGREGAR_DETALLE_BATERIAS(4, '2023-05-25', '13:30:00', 12.5, 70, 40.5, 1);
CALL AGREGAR_DETALLE_BATERIAS(4, '2023-05-25', '14:30:00', 12.5, 60, 20.3, 1);
CALL AGREGAR_DETALLE_BATERIAS(5, '2023-05-25', '12:30:00', 12.5, 80, 25.5, 1);
CALL AGREGAR_DETALLE_BATERIAS(5, '2023-05-25', '13:30:00', 12.5, 70, 40.5, 1);
CALL AGREGAR_DETALLE_BATERIAS(5, '2023-05-25', '14:30:00', 12.5, 60, 20.3, 1);
CALL AGREGAR_DETALLE_BATERIAS(6, '2023-05-25', '12:30:00', 12.5, 90, 25.5, 1);
CALL AGREGAR_DETALLE_BATERIAS(6, '2023-05-25', '13:30:00', 10.5, 75, 30.2, 1);
CALL AGREGAR_DETALLE_BATERIAS(6, '2023-05-25', '14:30:00', 12.5, 60, 20.3, 1);
CALL AGREGAR_DETALLE_BATERIAS(7, '2023-05-25', '12:30:00', 10.5, 95, 25.5, 1);
CALL AGREGAR_DETALLE_BATERIAS(7, '2023-05-25', '13:30:00', 11.5, 81, 15.5, 1);
CALL AGREGAR_DETALLE_BATERIAS(7, '2023-05-25', '14:30:00', 10.5, 54, 20.3, 1);
CALL AGREGAR_DETALLE_BATERIAS(8, '2023-05-25', '12:30:00', 12.5, 80, 25.5, 1);
CALL AGREGAR_DETALLE_BATERIAS(8, '2023-05-25', '13:30:00', 12.5, 70, 40.5, 1);
CALL AGREGAR_DETALLE_BATERIAS(8, '2023-05-25', '14:30:00', 12.5, 60, 20.3, 1);

SELECT * FROM EMPRESAS;
SELECT * FROM TRABAJADORES;
SELECT * FROM CAMIONES;
SELECT * FROM BATERIAS;
SELECT * FROM DETALLE_bATERIAS;

CALL DETALLESVALORES(1);


DELIMITER //
CREATE PROCEDURE DETALLESVALORES
(IN CAMION INT)
BEGIN
	SELECT B.NOM_BAT, C.PLACA_CAM, D.DIA, D.HORA, D.VOLTAJE, D.CARGA, D.TEMPERATURA
	FROM DETALLE_CAMIONES D
	INNER JOIN BATERIAS B ON B.ID_BAT = D.BAT_ID
	INNER JOIN CAMIONES C ON C.ID_CAM = B.CAM_ID
	WHERE B.CAM_ID= CAMION;
END //

CALL DETALLESVALORES(2); 

DELIMITER //
CREATE PROCEDURE DETALLESBATERIAS
(IN CAMION INT, IN BATERIA INT)
BEGIN
	SELECT B.NOM_BAT, C.PLACA_CAM, D.DIA, D.HORA, D.VOLTAJE, D.CARGA, D.TEMPERATURA
	FROM DETALLE_CAMIONES D
	INNER JOIN BATERIAS B ON B.ID_BAT = D.BAT_ID
	INNER JOIN CAMIONES C ON C.ID_CAM = B.CAM_ID
	WHERE B.CAM_ID = CAMION 
    AND B.ID_BAT = BATERIA;
END //

CALL DETALLESBATERIAS(1,1);